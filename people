#!/bin/bash

filename="$HOME/.people"

if [ ! -f "$filename" ]; then
  touch "$filename"
fi

case "$1" in
  add)
    if [ $# -ne 2 ]; then
      echo "Usage: people add <name>"
      exit 1
    fi
    date=$(date +%s)
    echo "$date	add	$2" >> "$filename"
    ;;
  list)
    if [ $# -ne 1 ]; then
      echo "Usage: people list"
      exit 1
    fi
    grep "^.*	add	.*$" "$filename" | awk '{print $3}' | sort | uniq
    ;;
  contact)
    person=$("$0" list | fzf)
    if [ -z "$person" ]; then
      exit 0
    fi

    date=$(date +%s)
    echo "$date	contact	$person" >> "$filename"
    ;;
  goal)
    person=$("$0" list | fzf)
    if [ -z "$person" ]; then
      exit 0
    fi

    read -r -p "Goal (in days): " goal
    if [ -z "$goal" ]; then
      exit 0
    fi

    date=$(date +%s)
    echo "$date	goal	$person	$goal" >> "$filename"
    ;;
  note)
    person=$("$0" list | fzf)
    if [ -z "$person" ]; then
      exit 0
    fi

    read -r -p "Note: " note
    if [ -z "$note" ]; then
      exit 0
    fi

    date=$(date +%s)
    echo "$date	note	$person	$note" >> "$filename"
    ;;
  *)
    echo "Usage: people <command>"
    echo "Commands:"
    echo "  add <name> - add a person"
    echo "  list - list people"
    echo "  contact - contact a person"
    echo "  goal - set a goal for a person"
    echo "  note - add a note for a person"
    exit 1
    ;;
esac
